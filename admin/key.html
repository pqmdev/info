 <!-- Share Source by PQM
 Tham gia giao lưu, trao đổi và hỗ trợ tại Discord:
 https://discord.gg/Bjb7EvsA -->
<!DOCTYPE html>
<html lang="vi" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Management Center - PQM System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
    <style>
        .key-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .integration-card {
            background: rgba(167, 139, 250, 0.1);
            border: 1px dashed var(--accent-color);
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
        }

        pre {
            background: #000;
            color: #55efc4;
            padding: 15px;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 0.85em;
            margin-top: 10px;
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }
    </style>
</head>

<body>

    <div class="key-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
                <a href="index.html" style="color: var(--accent-color); text-decoration: none; font-size: 0.9em;">
                    <i class="fas fa-chevron-left"></i> Quay lại Dashboard
                </a>
                <h1 style="text-align: left; margin: 10px 0 0 0; font-size: 2em;">Trung Tâm Quản Lý Key</h1>
            </div>
            <div id="status-indicators">
                <!-- Thống kê nhanh từ JS -->
            </div>
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid var(--border);">
            <button class="tab-btn active" onclick="switchTab('manage')">Quản Lý Key</button>
            <button class="tab-btn" onclick="switchTab('integration')">Tích Hợp (API/Tool)</button>
        </div>

        <!-- Tab: Quản Lý -->
        <div id="tab-manage">
            <div class="modal-content" style="display: block; position: static; width: 100%; margin: 0;">
                <div class="key-form" style="background: rgba(255,255,255,0.02);">
                    <input type="text" id="key-user" placeholder="Tên khách hàng / Ghi chú...">
                    <select id="key-time">
                        <option value="1">1 Giờ (Dùng thử)</option>
                        <option value="24">1 Ngày</option>
                        <option value="168">7 Ngày</option>
                        <option value="720">30 Ngày (Tháng)</option>
                        <option value="8760">1 Năm</option>
                        <option value="999999">Vĩnh viễn (Lifetime)</option>
                    </select>
                    <button class="btn btn-primary" onclick="addKey()">
                        <i class="fas fa-magic"></i> Tạo Mã Key
                    </button>
                </div>

                <div style="margin: 20px 0; display: flex; gap: 10px;">
                    <div style="position: relative; flex: 1;">
                        <input type="text" id="search-input" placeholder="Tìm kiếm theo mã key hoặc tên khách..."
                            onkeyup="filterKeys()"
                            style="width: 100%; border-radius: 10px; padding: 12px 15px; background: var(--card-bg); border: 1px solid var(--border); color: white;">
                    </div>
                    <button class="btn btn-danger" onclick="deleteExpiredKeys()" title="Dọn dẹp key hết hạn">
                        <i class="fas fa-broom"></i>
                    </button>
                </div>

                <div class="key-table-container">
                    <table class="key-table">
                        <thead>
                            <tr>
                                <th>Khách Hàng</th>
                                <th>Mã Kích Hoạt (Key)</th>
                                <th>Thời Hạn Hết Hạn</th>
                                <th>Trạng Thái</th>
                                <th>Hành Động</th>
                            </tr>
                        </thead>
                        <tbody id="key-list-render">
                            <!-- JS Render -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Tích Hợp -->
        <div id="tab-integration" style="display: none;">
            <div class="modal-content" style="display: block; position: static; width: 100%; margin: 0;">
                <h3 style="color: var(--accent-color); margin-bottom: 15px;">Hướng dẫn tích hợp Kích Hoạt Key</h3>
                <p style="font-size: 0.9em; opacity: 0.8;">Bạn có thể sử dụng đoạn mã JavaScript sau để kiểm tra tính
                    hợp lệ của Key trong các dự án tương lai (Website/Tool JS).</p>

                <div class="integration-card">
                    <strong>1. Cấu trúc dữ liệu (JSON):</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Hệ thống lưu trữ các key tại
                        <code>localStorage.getItem('sys_keys')</code>.</p>
                </div>

                <div class="integration-card">
                    <strong>2. Đoạn mã kiểm tra Key (Dành cho Tool/Website):</strong>
                    <pre>
async function validateKey(inputKey) {
    // 1. Tải dữ liệu key (Nếu bạn làm online, hãy fetch từ URL lưu file JSON)
    const database = JSON.parse(localStorage.getItem('sys_keys')) || [];
    
    // 2. Tìm kiếm key
    const found = database.find(k => k.code === inputKey);
    
    if (!found) return { status: 'invalid', message: 'Key không tồn tại!' };
    
    // 3. Kiểm tra thời hạn
    if (Date.now() > found.expires) {
        return { status: 'expired', message: 'Key đã hết hạn sử dụng!' };
    }
    
    return { 
        status: 'success', 
        user: found.user, 
        expiresAt: new Date(found.expires).toLocaleString('vi-VN') 
    };
}
                    </pre>
                </div>

                <p style="margin-top: 20px; font-size: 0.85em; color: var(--danger);">
                    <i class="fas fa-exclamation-triangle"></i> <strong>Lưu ý:</strong> Vì đây là hệ thống Client-side
                    (LocalStorage), nếu bạn muốn dùng Key này cho Tool cài đặt trên máy tính khác, bạn cần xuất file
                    JSON và upload lên một link (như GitHub Gist/Dropbox) sau đó cho Tool tải file đó về để đối chiếu.
                </p>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script>
        function switchTab(tab) {
            document.getElementById('tab-manage').style.display = tab === 'manage' ? 'block' : 'none';
            document.getElementById('tab-integration').style.display = tab === 'integration' ? 'block' : 'none';

            const btns = document.querySelectorAll('.tab-btn');
            btns[0].classList.toggle('active', tab === 'manage');
            btns[1].classList.toggle('active', tab === 'integration');
        }

        // Ghi đè hàm render để tương thích với giao diện mới
        const originalRender = render;
        window.render = function (filter = '') {
            originalRender(filter);
            // Cập nhật indicators ở header nếu cần
        };
    </script>
</body>

</html>
